<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
        </style>
    </head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };

        const createScene = () => {
            const scene = new BABYLON.Scene(engine);
            var ground = new BABYLON.MeshBuilder();
            var tiles = [];
            var sounds = [];

            const camera = new BABYLON.ArcRotateCamera("camera", -3 * Math.PI / 4,  -1.5 * Math.PI , 60, new BABYLON.Vector3(0, 10, 0));
            camera.position = new BABYLON.Vector3(100, 100, 100); //220, 220, 220
            camera.attachControl(canvas, true);
            const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));

            // Grounds
            //Parametros: name, width, depth, subdivs, scene
            var groundFloor = BABYLON.Mesh.CreateGround("groundFloor", 100, 100, 2, scene);

            var groundSeesaw = BABYLON.Mesh.CreateGround("groundSeesaw", 100, 30, 2, scene);
            groundSeesaw.position.y += 30;
            groundSeesaw.position.z += -25;

            var groundMaterial = new BABYLON.StandardMaterial("groundMaterial", scene);
            groundMaterial.ambientTexture  = new BABYLON.Texture("assets/woodtiles.jpg", scene);
            groundFloor.material = groundMaterial;
            groundSeesaw.material = groundMaterial;

            scene.enablePhysics();
            
            groundFloor.physicsImpostor = new BABYLON.PhysicsImpostor(groundFloor, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.5 }, scene);
            groundSeesaw.physicsImpostor = new BABYLON.PhysicsImpostor(groundSeesaw, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.5 }, scene);

            //Mostra eixo - função auxiliar
            showWorldAxis(10);

            //Pendulo
            spawnPendulum(scene, new BABYLON.Vector3(48, 32, -35), 0, "pendulum1");

            //Blocos crescentes piso superior
            growingBlocks(scene, new BABYLON.Vector3(47, 30, -35), -Math.PI/2, 0, 10, "gb1", false); //scene, position, size, qtt, name, drop

            // Gangorra
            spawnSeesaw(scene, new BABYLON.Vector3(5, 31, -35), 0);

            // Bola grande piso superior
            setTimeout(() => { spawnHeavyBall(scene, new BABYLON.Vector3(-17, 42, -33), 12) }, 6000);

            // Blocos do mesmo tamanho piso superior
            sameSizeBlocks(scene, new BABYLON.Vector3(-20, 30, -28), 0, 1, 18, "ssb", false);

            // Bola menor superior
            spawnHeavyBall(scene, new BABYLON.Vector3(-20, 31, -10), 0.8)

            // rampas com bola pequena
            spawnRamp(scene, new BABYLON.Vector3(-20.5, 29, -10), Math.PI/8, 0.25, 1, "1");
            spawnRamp(scene, new BABYLON.Vector3(-20.5, 15, 2), -Math.PI/8, 0.25, 1, "2");
            spawnRamp(scene, new BABYLON.Vector3(-20.5, 10, -15), Math.PI/8, 0.25, 1, "3");

            // Blocos do mesmo tamanho rotacionando
            sameSizeBlocksRotatedFalling(scene, new BABYLON.Vector3(-24.5, 0, 5), 0, 30, 3/2 * Math.PI, 5, "rttb", false);

            // Blocos do mesmo tamanho piso inferior 1
            sameSizeBlocks(scene, new BABYLON.Vector3(-22.5, 0, 0), Math.PI/2, 1, 15, "ssb", true);

            // Blocos do mesmo tamanho piso inferior 2
            sameSizeBlocks(scene, new BABYLON.Vector3(-7, 0, -0.6), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(-7, 0, 0.6), Math.PI/2, 1, 3, "ssb", false);

            // Blocos do mesmo tamanho piso inferior 3
            sameSizeBlocks(scene, new BABYLON.Vector3(-4, 0, -1.2), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(-4, 0, 0), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(-4, 0, 1.2), Math.PI/2, 1, 3, "ssb", false);

            // Blocos do mesmo tamanho piso inferior 4
            sameSizeBlocks(scene, new BABYLON.Vector3(-1, 0, -1.8), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(-1, 0, -0.6), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(-1, 0, 0.6), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(-1, 0, 1.8), Math.PI/2, 1, 3, "ssb", false);

            // Blocos do mesmo tamanho piso inferior 5
            sameSizeBlocks(scene, new BABYLON.Vector3(2, 0, -2.4), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(2, 0, -1.2), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(2, 0, 0), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(2, 0, 1.2), Math.PI/2, 1, 3, "ssb", false);
            sameSizeBlocks(scene, new BABYLON.Vector3(2, 0, 2.4), Math.PI/2, 1, 3, "ssb", false);

            //cilindro piso inferior
            spawnCylinder(scene,new BABYLON.Vector3(8.5, 10, 0), 0, 40, 3, "cilinder");

            //Blocos crescente piso inferior
            growingBlocks(scene, new BABYLON.Vector3(20, 0, 20), Math.PI/2, 0, 10, "gb1", false); //scene, position, size, qtt, name, drop
            growingBlocks(scene, new BABYLON.Vector3(20, 0, -20), Math.PI/2, 0, 10, "gb1", false);

            // 7 - Mobile
            // spawnMobile(scene);
            // ramp(scene, new BABYLON.Vector3(0, 35, -100), Math.PI/8);
            // spawnBall(scene, new BABYLON.Vector3(5, 30, -30), 10);

            // rampa com bola grande
            //bola em linha reta
            //bola que quica
            //beixiga explode
            //bolas que colidem
            
            
            return scene;
        }

        function growingBlocks(scene, positionOnScene, rotationOnScene, sizeBlocks, quantityBlocks, name, drop){
            //declarar array de blocos
            var arrayBlocks = [];

            for(i = 0; i < quantityBlocks; i++){
                var block = BABYLON.MeshBuilder.CreateBox("growingBlock" + name + i, 
                    {height: 3 + i + sizeBlocks, width: 0.75 + i + (0.25 * sizeBlocks), depth: 0.25 + (0.25/3)*sizeBlocks});
                arrayBlocks.push(block);
            }

            // material rosa
            var myMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
            myMaterial.ambientTexture  = new BABYLON.Texture("assets/darkWoodTexture.jpg", scene);
            // myMaterial.diffuseColor = new BABYLON.Color3(1, 0, 1);

            // definir rotação do menor bloco para cair
            if(drop)
                arrayBlocks[0].rotation = new BABYLON.Vector3(60, 0, 0);
            i = 0;

            // definir posição, material e física dos blocos
            arrayBlocks.forEach(block => {
                block.position.z += 2 * i;
                block.position.y += 1.5 + i/2 + sizeBlocks/2;
                // block.position.x += positionOnScene.x;
                block.material = myMaterial;
                block.physicsImpostor = new BABYLON.PhysicsImpostor(block, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1 + i, restitution: 0.5 }, scene);
                i++;
            });
            
            var groupedBlocks = new BABYLON.TransformNode();
            arrayBlocks.forEach(mesh => {
                mesh.parent = groupedBlocks
            })
            groupedBlocks.rotation.y += rotationOnScene;
            
            groupedBlocks.position.x += positionOnScene.x;
            groupedBlocks.position.y += positionOnScene.y;
            groupedBlocks.position.z += positionOnScene.z;
        }

        function sameSizeBlocks(scene, positionOnScene, rotationOnScene, sizeBlocks, quantityBlocks, name, drop){
            //declarar array de blocos
            var arrayBlocks = [];
            for(i = 0; i < quantityBlocks; i++){
                var block = BABYLON.MeshBuilder.CreateBox("sameBlock" + name + i,   
                    {height: 2 + sizeBlocks, width: 0.75 + sizeBlocks * 0.375, depth: 0.1 + 0.05 * sizeBlocks});
                arrayBlocks.push(block);
            }

            // material
            var myMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
            myMaterial.ambientTexture  = new BABYLON.Texture("assets/marbleTexture.jpg", scene);

            // definir rotação do menor bloco para cair
            if(drop)
                arrayBlocks[0].rotation = new BABYLON.Vector3(85, 0, 0);
            i = 0;

            // definir posição, material e física dos blocos
            arrayBlocks.forEach(block => {
                block.position.z += i;
                block.position.y += 1 + sizeBlocks/2;
                block.material = myMaterial;
                block.physicsImpostor = new BABYLON.PhysicsImpostor(block, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 10, restitution: 0.5 }, scene);
                i++;
            });

            // Agrupar para poder rotacionar 
            var groupedBlocks = new BABYLON.TransformNode();
            arrayBlocks.forEach(mesh => {
                mesh.parent = groupedBlocks
            })
            groupedBlocks.rotation.y += rotationOnScene;
            
            groupedBlocks.position.x += positionOnScene.x;
            groupedBlocks.position.y += positionOnScene.y;
            groupedBlocks.position.z += positionOnScene.z;
        }
        
        function sameSizeBlocksRotatedFalling(scene, positionOnScene, sizeBlocks, quantityBlocks, sizeRotation, radius, name, drop){
            //declarar array de blocos
            var arrayBlocks = [];
            for(i = 0; i < quantityBlocks; i++){
                var block = BABYLON.MeshBuilder.CreateBox("rotatingBlock" + name + i, 
                {height: 2.5 + sizeBlocks, width: 0.75 + sizeBlocks * 0.375, depth: 0.2 + 0.1 * sizeBlocks});
                arrayBlocks.push(block);
            }

            // material rosa
            var myMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
            myMaterial.ambientTexture  = new BABYLON.Texture("assets/marbleTexture.jpg", scene);

            // definir rotação do menor bloco para cair
            if(drop)
                arrayBlocks[0].rotation = new BABYLON.Vector3(85, 0, 0);
            i = 0;

            // definir posição, material e física dos blocos
            arrayBlocks.forEach(block => {
                block.position.z += radius * (Math.sin(i * (sizeRotation/2) / (quantityBlocks/2))) + positionOnScene.z;
                block.position.y += 1.25 + positionOnScene.y;
                block.position.x += radius * (Math.cos(i * (sizeRotation/2) / (quantityBlocks/2))) + (quantityBlocks/25 * i / quantityBlocks) + positionOnScene.x;

                block.rotation = new BABYLON.Vector3(0, -i * (sizeRotation)/ quantityBlocks,  0);
                
                if(i==0 && drop)
                    block.rotation = new BABYLON.Vector3(0.15, 0, 0);    
                
                block.material = myMaterial;
                block.physicsImpostor = new BABYLON.PhysicsImpostor(block, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 2, restitution: 0.5 }, scene);
                
                i++;
            });
        }

        function spawnRamp(scene, rampPosition, rampRotation, thickness, ballSize, name){
            var shape0 = [
                        new BABYLON.Vector3(0, 0, 0),
                        new BABYLON.Vector3(2 * thickness + ballSize, 0, 0),
                        new BABYLON.Vector3(2 * thickness + ballSize, 0, (2 * thickness + ballSize)/2),
                        new BABYLON.Vector3(thickness + ballSize, 0, (2 * thickness + ballSize)/2),
                        new BABYLON.Vector3(thickness + ballSize, 0, thickness),
                        new BABYLON.Vector3(thickness, 0, thickness),
                        new BABYLON.Vector3(thickness, 0, (2 * thickness + ballSize)/2),
                        new BABYLON.Vector3(0, 0, (2 * thickness + ballSize)/2)
                    ];

            // material rosa
            var myMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
            myMaterial.ambientTexture  = new BABYLON.Texture("assets/lightWoodTexture.jpg", scene);
            // myMaterial.diffuseColor = new BABYLON.Color3(1, 0, 1);
            
            rampObj = BABYLON.MeshBuilder.ExtrudePolygon("ramp" + name, {shape:shape0, depth: 15 * ballSize, sideOrientation: BABYLON.Mesh.DOUBLESIDE });
            rampObj.material = myMaterial;
            rampObj.position.y += rampPosition.y; //30;
            rampObj.position.z += rampPosition.z; //-20;
            rampObj.position.x += rampPosition.x;
            // rampObj.position.z += thickness;
            rampObj.rotation = new BABYLON.Vector3(-Math.PI/2 + rampRotation, 0, 0); //rampPosition = Math.PI/8

            rampObj.physicsImpostor = new BABYLON.PhysicsImpostor(rampObj, BABYLON.PhysicsImpostor.MeshImpostor,{mass:0, friction:1},scene);
        }

        function spawnHeavyBall(scene, ballPosition, ballSize){
            var ball = BABYLON.Mesh.CreateSphere("ball", 16, ballSize, scene);

            var myMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
            myMaterial.ambientTexture  = new BABYLON.Texture("assets/glassTexture.jpg", scene);
            ball.material = myMaterial;
            
            ball.position.y += ballPosition.y;
            ball.position.z += ballPosition.z;
            ball.position.x += ballPosition.x;
            
            ball.physicsImpostor = new BABYLON.PhysicsImpostor(ball, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 5, restitution: 0, friction:0.5 }, scene);
        }

        function spawnLightBall(scene, ballPosition, ballSize){
            var ball = BABYLON.Mesh.CreateSphere("ball", 16,ballSize, scene);
            
            ball.position.y += ballPosition.y;
            ball.position.z += ballPosition.z;
            ball.position.x += ballPosition.x;
            
            ball.physicsImpostor = new BABYLON.PhysicsImpostor(ball, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 3, friction:0.5 }, scene);
        }

        function spawnPendulum(scene, positionOnScene, rotationOnScene, name){
            //Pivot (para unir a movimentação do pêndulo)
            var pivot = BABYLON.MeshBuilder.CreateCylinder("pivot" + name, {diameter:0.5, height: 0.1}, scene);
            pivot.rotation = new BABYLON.Vector3(Math.PI/2, 0, 0);
            
            var pivotMaterial = new BABYLON.StandardMaterial("pivotMaterial" + name, scene);
            pivotMaterial.diffuseColor = new BABYLON.Color3.White();
            pivot.material = pivotMaterial;
            
            //Corda
            var rope = BABYLON.MeshBuilder.CreateBox("Rope", {height: 0.1, width:8, depth:0.1}, scene);
            rope.position = new BABYLON.Vector3(3, 0, 0);
            
            var ropeMaterial = new BABYLON.StandardMaterial("ropeMaterial", scene);
            ropeMaterial.ambientTexture  = new BABYLON.Texture("assets/ropeTexture.jpg", scene);
            rope.material = ropeMaterial;

            //bola
            var ball = BABYLON.Mesh.CreateSphere("ball", 16, 2, scene);
            ball.position = new BABYLON.Vector3(7, 0, 0);
            
            var ballMaterial = new BABYLON.StandardMaterial("ballMaterial", scene);
            ballMaterial.ambientTexture  = new BABYLON.Texture("assets/marbleTexture.jpg", scene);
            ball.material = ballMaterial;

            pivot.position.y += 10;
            rope.position.y += 5;
            ball.position.y += 5;

            var mesh = BABYLON.Mesh.MergeMeshes([rope, ball]);

            // Physics
            scene.enablePhysics(new BABYLON.Vector3(0, 0, 0), new BABYLON.CannonJSPlugin());

            mesh.physicsImpostor = new BABYLON.PhysicsImpostor(mesh, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 5, restitution: 0, friction:0.5 }, scene);
            pivot.physicsImpostor = new BABYLON.PhysicsImpostor(pivot, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 0}, scene);
            
            //Joint
            var joint1 = new BABYLON.PhysicsJoint(BABYLON.PhysicsJoint.HingeJoint, {  
                mainPivot: new BABYLON.Vector3(0, 0, 0),
                connectedPivot: new BABYLON.Vector3(-4.75, 0, 0),
                mainAxis: new BABYLON.Vector3(0, 0, 1),
                connectedAxis: new BABYLON.Vector3(0, 0, 0),
                nativeParams: {
                }
            }); 

            pivot.physicsImpostor.addJoint(mesh.physicsImpostor, joint1);    

            var groupedMeshes = new BABYLON.TransformNode();
            pivot.parent = groupedMeshes;
            mesh.parent = groupedMeshes;
            groupedMeshes.rotation.y += rotationOnScene;
            
            groupedMeshes.position.x += positionOnScene.x;
            groupedMeshes.position.y += positionOnScene.y;
            groupedMeshes.position.z += positionOnScene.z;
        }

        function spawnSeesaw(scene, positionOnScene, rotationOnScene){
            //Pivot
            var pivot = BABYLON.MeshBuilder.CreateCylinder("pivot", {diameter:4, height: 4}, scene);
            pivot.rotation = new BABYLON.Vector3(Math.PI/2, 0, 0);
            
            var pivotMaterial = new BABYLON.StandardMaterial("pivotMaterial", scene);
            pivotMaterial.ambientTexture  = new BABYLON.Texture("assets/darkWoodTexture.jpg", scene);
            pivot.material = pivotMaterial;
            
            //Tampo
            var box = BABYLON.MeshBuilder.CreateBox("Box", {height: 1, width:35, depth:4}, scene);
            box.position = new BABYLON.Vector3(3, 0, 0);

            var boxMaterial = new BABYLON.StandardMaterial("boxMaterial", scene);
            boxMaterial.ambientTexture  = new BABYLON.Texture("assets/rubberGreyTexture.jpg", scene);
            box.material = boxMaterial;

            pivot.position.y += 1;
            box.position.y += 1;

            // Physics
            scene.enablePhysics(new BABYLON.Vector3(0, 0, 0), new BABYLON.CannonJSPlugin());

            box.physicsImpostor = new BABYLON.PhysicsImpostor(box, BABYLON.PhysicsImpostor.BoxImpostor, {  mass: 1, restitution: 1, friction:0.5  }, scene);
            pivot.physicsImpostor = new BABYLON.PhysicsImpostor(pivot, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 0}, scene);
            
            //Joint
            var joint1 = new BABYLON.PhysicsJoint(BABYLON.PhysicsJoint.HingeJoint, {  
                mainPivot: new BABYLON.Vector3(0, 0, 0),
                connectedPivot: new BABYLON.Vector3(0, -2.5, 0),
                mainAxis: new BABYLON.Vector3(0, 0, 1),
                connectedAxis: new BABYLON.Vector3(0, 0, 0),
                nativeParams: {
                }
            }); 

            pivot.physicsImpostor.addJoint(box.physicsImpostor, joint1);

            var groupedMeshes = new BABYLON.TransformNode();
            pivot.parent = groupedMeshes;
            box.parent = groupedMeshes;
            groupedMeshes.rotation.y += rotationOnScene;
            
            groupedMeshes.position.x += positionOnScene.x;
            groupedMeshes.position.y += positionOnScene.y;
            groupedMeshes.position.z += positionOnScene.z;
        }
      
        function spawnMobile(scene){   
            var boxHorizontal = BABYLON.MeshBuilder.CreateBox("BoxHorizontal", {height: 0.5, width:0.5, depth:15}, scene);
            boxHorizontal.position = new BABYLON.Vector3(0, 7.5, 0);
            var blueMat = new BABYLON.StandardMaterial("blue", scene);
            blueMat.diffuseColor = new BABYLON.Color3.Blue();
            boxHorizontal.material = blueMat;

            // var mesh = BABYLON.Mesh.MergeMeshes([boxVertical, boxHorizontal]);

            //Pivot
            var pivot = BABYLON.MeshBuilder.CreateCylinder("pivot", {diameter:1, height: 15}, scene);
            var greenMat = new BABYLON.StandardMaterial("green", scene);
            greenMat.diffuseColor = new BABYLON.Color3.Green();
            pivot.material = greenMat;
            pivot.position.y += 10;

            pivot.rotation.y = Math.PI/2;
            boxHorizontal.rotation.y = Math.PI/2;

            scene.enablePhysics(new BABYLON.Vector3(0, 0, 0), new BABYLON.CannonJSPlugin());

            boxHorizontal.physicsImpostor = new BABYLON.PhysicsImpostor(boxHorizontal, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 1, friction:0.5 }, scene);
            pivot.physicsImpostor = new BABYLON.PhysicsImpostor(pivot, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 0}, scene);
            
            //Joint
            var joint1 = new BABYLON.PhysicsJoint(BABYLON.PhysicsJoint.HingeJoint, {  
                mainPivot: new BABYLON.Vector3(0, 0, 0),
                connectedPivot: new BABYLON.Vector3(0, 7.5, 0),
                mainAxis: new BABYLON.Vector3(0, 1, 0),
                connectedAxis: new BABYLON.Vector3(0, 0, 0),
                nativeParams: {
                }
            }); 

            pivot.physicsImpostor.addJoint(boxHorizontal.physicsImpostor, joint1);
        }

        function spawnCylinder(scene, positionOnScene, rotationScene, heightCylinder, radiusCylinder, name){
            var cylinder = BABYLON.MeshBuilder.CreateCylinder("cylinder" + name, {diameter:2*radiusCylinder, height: heightCylinder}, scene);

            var myMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
            myMaterial.ambientTexture  = new BABYLON.Texture("assets/marbleTile.jpg", scene);
            cylinder.material = myMaterial;
            
            cylinder.rotation.x += Math.PI/2;

            cylinder.position.y += positionOnScene.y;
            cylinder.position.z += positionOnScene.z;
            cylinder.position.x += positionOnScene.x;
            
            cylinder.physicsImpostor = new BABYLON.PhysicsImpostor(cylinder, BABYLON.PhysicsImpostor.CylinderImpostor, { mass: 1, restitution: 0, friction:0.5 }, scene);
        }

        function showWorldAxis(size) {
            var makeTextPlane = function(text, color, size) {
                var dynamicTexture = new BABYLON.DynamicTexture("DynamicTexture", 50, scene, true);
                dynamicTexture.hasAlpha = true;
                dynamicTexture.drawText(text, 5, 40, "bold 36px Arial", color , "transparent", true);
                var plane = BABYLON.Mesh.CreatePlane("TextPlane", size, scene, true);
                plane.material = new BABYLON.StandardMaterial("TextPlaneMaterial", scene);
                plane.material.backFaceCulling = false;
                plane.material.specularColor = new BABYLON.Color3(0, 0, 0);
                plane.material.diffuseTexture = dynamicTexture;
            return plane;
            };
            var axisX = BABYLON.Mesh.CreateLines("axisX", [ 
            BABYLON.Vector3.Zero(), new BABYLON.Vector3(size, 0, 0), new BABYLON.Vector3(size * 0.95, 0.05 * size, 0), 
            new BABYLON.Vector3(size, 0, 0), new BABYLON.Vector3(size * 0.95, -0.05 * size, 0)
            ], scene);
            axisX.color = new BABYLON.Color3(1, 0, 0);
            var xChar = makeTextPlane("X", "red", size / 10);
            xChar.position = new BABYLON.Vector3(0.9 * size, -0.05 * size, 0);
            var axisY = BABYLON.Mesh.CreateLines("axisY", [
                BABYLON.Vector3.Zero(), new BABYLON.Vector3(0, size, 0), new BABYLON.Vector3( -0.05 * size, size * 0.95, 0), 
                new BABYLON.Vector3(0, size, 0), new BABYLON.Vector3( 0.05 * size, size * 0.95, 0)
                ], scene);
            axisY.color = new BABYLON.Color3(0, 1, 0);
            var yChar = makeTextPlane("Y", "green", size / 10);
            yChar.position = new BABYLON.Vector3(0, 0.9 * size, -0.05 * size);
            var axisZ = BABYLON.Mesh.CreateLines("axisZ", [
                BABYLON.Vector3.Zero(), new BABYLON.Vector3(0, 0, size), new BABYLON.Vector3( 0 , -0.05 * size, size * 0.95),
                new BABYLON.Vector3(0, 0, size), new BABYLON.Vector3( 0, 0.05 * size, size * 0.95)
                ], scene);
            axisZ.color = new BABYLON.Color3(0, 0, 1);
            var zChar = makeTextPlane("Z", "blue", size / 10);
            zChar.position = new BABYLON.Vector3(0, 0.05 * size, 0.9 * size);
        };
          
        //_________________________________________________________________
        function createWhiteKey(typeOfKey, keyId){
            var key;
            switch(typeOfKey){
                case 0:
                    var shape0 = [
                        new BABYLON.Vector3(0, 0, 0),
                        new BABYLON.Vector3(3, 0, 0),
                        new BABYLON.Vector3(3, 0, 12),
                        new BABYLON.Vector3(0, 0, 12)

                    ];
                    key = BABYLON.MeshBuilder.ExtrudePolygon("whiteKey" + keyId, {shape:shape0, depth: 1.5, sideOrientation: BABYLON.Mesh.DOUBLESIDE });
                    break;

                case 1:
                    var shape1 = [
                        new BABYLON.Vector3(0, 0, 0),
                        new BABYLON.Vector3(3, 0, 0),
                        new BABYLON.Vector3(3, 0, 12),
                        new BABYLON.Vector3(1, 0, 12),
                        new BABYLON.Vector3(1, 0, 6),
                        new BABYLON.Vector3(0, 0, 6)

                    ];
                    key = BABYLON.MeshBuilder.ExtrudePolygon("whiteKey" + keyId, {shape:shape1, depth: 1.5, sideOrientation: BABYLON.Mesh.DOUBLESIDE });
                    break;

                case 2:
                var shape2 = [
                        new BABYLON.Vector3(0, 0, 0),
                        new BABYLON.Vector3(3, 0, 0),
                        new BABYLON.Vector3(3, 0, 6),
                        new BABYLON.Vector3(2, 0, 6),
                        new BABYLON.Vector3(2, 0, 12),
                        new BABYLON.Vector3(0, 0, 12)

                    ];
                    key = BABYLON.MeshBuilder.ExtrudePolygon("whiteKey" + keyId, {shape:shape2, depth: 1.5, sideOrientation: BABYLON.Mesh.DOUBLESIDE });
                    break;

                case 3:
                    var shape3 = [
                        new BABYLON.Vector3(0, 0, 0),
                        new BABYLON.Vector3(3, 0, 0),
                        new BABYLON.Vector3(3, 0, 6),
                        new BABYLON.Vector3(2, 0, 6),
                        new BABYLON.Vector3(2, 0, 12),
                        new BABYLON.Vector3(1, 0, 12),
                        new BABYLON.Vector3(1, 0, 6),
                        new BABYLON.Vector3(0, 0, 6),

                    ];
                    key = BABYLON.MeshBuilder.ExtrudePolygon("whiteKey" + keyId, {shape:shape3, depth: 1.5, sideOrientation: BABYLON.Mesh.DOUBLESIDE });
                    break;
                default:
                    break;
            }

            key.setPositionWithLocalVector(new BABYLON.Vector3(keyId * 3.25 - 24, 0, 0));
            return key;
        }

        function createBlackKeys(keyId){
            var key;
            var shape4 = [
                        new BABYLON.Vector3(0, 0, 0),
                        new BABYLON.Vector3(2, 0, 0),
                        new BABYLON.Vector3(1.5, 0, 1.5),
                        new BABYLON.Vector3(0.5, 0, 1.5)
                    ];
            key = BABYLON.MeshBuilder.ExtrudePolygon("blackKey" + keyId, {shape:shape4, depth: 6, sideOrientation: BABYLON.Mesh.DOUBLESIDE });

            var myMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
            myMaterial.diffuseColor = new BABYLON.Color3(0.1, 0.1, 0.1);
            key.material = myMaterial;

            key.rotation.x = -(Math.PI)/2;
            key.setPositionWithLocalVector(new BABYLON.Vector3(2.25 + 3.25 * keyId -24 , -6, -1));
        }

        function animateTile(tile, sounds){
            var frameRate = 10;
                    var ySlide = new BABYLON.Animation("ySlide", "position.y", frameRate, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);

                    var keyFrames = [];

                    if(tile.name.includes("white")){
                                keyFrames.push({
                                frame: 0,
                                value: 0
                            });

                            keyFrames.push({
                                frame: frameRate,
                                value: -0.5
                            });

                            keyFrames.push({
                                frame: 2 * frameRate,
                                value: 0
                            });
                    }

                    else {
                                keyFrames.push({
                                frame: 0,
                                value: -1
                            });

                            keyFrames.push({
                                frame: frameRate,
                                value: -2
                            });

                            keyFrames.push({
                                frame: 2 * frameRate,
                                value: -1
                            });
                        }

                    ySlide.setKeys(keyFrames);
                    createParticles(tile);
                    return ySlide;
        }

        function defineNote(tileName, sounds){
            if(tileName.includes("white")){
                switch(tileName){
                    case("whiteKey0"):
                        return sounds[0];
                        break;
                    case("whiteKey1"):
                        return sounds[2];
                        break;
                    case("whiteKey2"):
                        return sounds[4];
                        break;
                    case("whiteKey3"):
                        return sounds[5];
                        break;
                    case("whiteKey4"):
                        return sounds[7];
                        break;
                    case("whiteKey5"):
                        return sounds[9];
                        break;
                    case("whiteKey6"):
                        return sounds[11];
                        break;
                    case("whiteKey7"):
                        return sounds[12];
                        break;
                    case("whiteKey8"):
                        return sounds[14];
                        break;
                    case("whiteKey9"):
                        return sounds[16];
                        break;
                    case("whiteKey10"):
                        return sounds[17];
                        break;
                    case("whiteKey11"):
                        return sounds[19];
                        break;
                    case("whiteKey12"):
                        return sounds[21];
                        break;
                    case("whiteKey13"):
                        return sounds[23];
                        break;
                    case("whiteKey14"):
                        return sounds[24];
                        break;
                }
            }

            if(tileName.includes("black")){
                switch(tileName){
                    case("blackKey0"): //do1sus
                        return sounds[1];
                        break;
                    case("blackKey1"): //re1sus
                        return sounds[3];
                        break;
                    case("blackKey3"): //fa1sus
                        return sounds[6];
                        break;
                    case("blackKey4"): //sol1sus
                        return sounds[8];
                        break;
                    case("blackKey5"): //la1sus
                        return sounds[10];
                        break;
                    case("blackKey7"): //do2sus
                        return sounds[13];
                        break;
                    case("blackKey8"): //re2sus
                        return sounds[15];
                        break;
                    case("blackKey10"): //fa2sus
                        return sounds[18];
                        break;
                    case("blackKey11"): //sol2sus
                        return sounds[20];
                        break;
                    case("blackKey12"): //la2sus
                        return sounds[22];
                        break;
            }
        }
        }

        //demos de músicas
        function demoModeNonaSinfonia(scene, sounds){
            var speed = 150;
            var timePassed = 0;

            playTileByNoteName("mi1", scene, sounds);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("mi1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("fa1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("fa1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("mi1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("re1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("re1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("mi1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("mi1", scene, sounds) }, timePassed);
            timePassed += 2.5*speed;
            setTimeout(() => { playTileByNoteName("re1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re1", scene, sounds) }, timePassed);
        }

        function demoModePourElise(scene, sounds){
            var speed = 250;
            var timePassed = 0;

            playTileByNoteName("mi2", scene, sounds);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("si1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1", scene, sounds) }, timePassed);

            timePassed += 2.5*speed;
            setTimeout(() => { playTileByNoteName("do1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("mi1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("si1", scene, sounds) }, timePassed);

            timePassed += 2.5*speed;
            setTimeout(() => { playTileByNoteName("mi1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol1sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("si1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
        }

        function demoModeMario(scene, sounds){
            var speed = 150;
            var timePassed = 0;

            playTileByNoteName("mi2", scene, sounds);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);

            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
            timePassed += 4*speed;
            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);

            timePassed += 4*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 3*speed;
            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);
            timePassed += 3*speed;
            setTimeout(() => { playTileByNoteName("mi1", scene, sounds) }, timePassed);
            timePassed += 3*speed;
            setTimeout(() => { playTileByNoteName("la1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("si1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
            timePassed += 1*speed;
            setTimeout(() => { playTileByNoteName("la1", scene, sounds) }, timePassed);

            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);
            timePassed += 1.66*speed;
            setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
            timePassed += 1.66*speed;
            setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
            timePassed += 1.66*speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += 1*speed;
            setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);

            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 1*speed;
            setTimeout(() => { playTileByNoteName("re2", scene, sounds) }, timePassed);
            timePassed += 1*speed;
            setTimeout(() => { playTileByNoteName("si1", scene, sounds) }, timePassed);
            
        }

        function demoModeSigurRosUntitled3(scene, sounds){
            var speed = 350;
            var timePassed = 0;

            playTileByNoteName("re2", scene, sounds);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa1", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("re2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
            timePassed += speed;        
        }

        function demoRadioheadNoSurprises(scene, sounds){
            var speed = 400;
            var timePassed = 0;

            for(i = 0; i < 2 ; i++){
                setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);

                timePassed += speed;
                setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);

                timePassed += speed;
                setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);

                timePassed += speed;
                setTimeout(() => { playTileByNoteName("la1sus", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("do2sus", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
                timePassed += speed;
            }
            
            
        }

        function demoLAutreValseDAmelie(scene, sounds){
            var speed = 150;
            var timePassed = 0;

            for(i = 0; i<2; i++){
                setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
                timePassed += 6* speed;

                setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
                timePassed += speed;
                setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
                timePassed += 2*speed;
                setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
                timePassed += 3*speed;
                setTimeout(() => { playTileByNoteName("mi2", scene, sounds) }, timePassed);
                timePassed += 2*speed;
                setTimeout(() => { playTileByNoteName("re2sus", scene, sounds) }, timePassed);
                timePassed += 6*speed;
                setTimeout(() => { playTileByNoteName("do2sus", scene, sounds) }, timePassed);
                timePassed += 6*speed;
                setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
                timePassed += 6*speed;
                setTimeout(() => { playTileByNoteName("do2sus", scene, sounds) }, timePassed);
                timePassed += 6*speed;
            }
            
        }

        function demoBrasileirinho(scene, sounds){
            var speed = 120;
            var timePassed = 0;

            playTileByNoteName("la2", scene, sounds);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol2sus", scene, sounds) }, timePassed);

            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol2sus", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol2sus", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol2sus", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol2sus", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);

            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);

            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("la2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol2sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("sol2", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2sus", scene, sounds) }, timePassed);
            timePassed += speed;
            setTimeout(() => { playTileByNoteName("fa2", scene, sounds) }, timePassed);
            timePassed += speed;
            
        }

        function demoBabyShark(scene, sounds){
            var speed = 125;
            var timePassed = 0;

            playTileByNoteName("sol1", scene, sounds);
            timePassed += 4*speed;
            setTimeout(() => { playTileByNoteName("la1", scene, sounds) }, timePassed);
            timePassed += 4*speed;

            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 1*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 3*speed;

            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("la1", scene, sounds) }, timePassed);
            timePassed += 2*speed;

            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 1*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 3*speed;

            setTimeout(() => { playTileByNoteName("sol1", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("la1", scene, sounds) }, timePassed);
            timePassed += 2*speed;

            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 1*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 3*speed;

            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("do2", scene, sounds) }, timePassed);
            timePassed += 2*speed;
            setTimeout(() => { playTileByNoteName("si1", scene, sounds) }, timePassed);
            timePassed += 2*speed;

        }
        
        function loadSoundsToScene(scene){
            var sounds = [];
            var sound = new BABYLON.Sound("do1", "http://localhost:5500/assets/PianoNotes/1-do1.mp3", scene)
            sounds.push(sound);
            sounds.push(new BABYLON.Sound("do1sus", "http://localhost:5500/assets/PianoNotes/2-do1sus.mp3", scene));
            sounds.push(new BABYLON.Sound("re1", "http://localhost:5500/assets/PianoNotes/3-re1.mp3", scene));
            sounds.push(new BABYLON.Sound("re1sus", "http://localhost:5500/assets/PianoNotes/4-re1sus.mp3", scene));
            sounds.push(new BABYLON.Sound("mi1", "http://localhost:5500/assets/PianoNotes/5-mi1.mp3", scene));
            sounds.push(new BABYLON.Sound("fa1", "http://localhost:5500/assets/PianoNotes/6-fa1.mp3", scene));
            sounds.push(new BABYLON.Sound("fa1sus", "http://localhost:5500/assets/PianoNotes/7-fa1sus.mp3", scene));
            sounds.push(new BABYLON.Sound("sol1", "http://localhost:5500/assets/PianoNotes/8-sol1.mp3", scene));
            sounds.push(new BABYLON.Sound("sol1sus", "http://localhost:5500/assets/PianoNotes/9-sol1sus.mp3", scene));
            sounds.push(new BABYLON.Sound("la1", "http://localhost:5500/assets/PianoNotes/10-la1.mp3", scene));
            sounds.push(new BABYLON.Sound("la1sus", "http://localhost:5500/assets/PianoNotes/11-la1sus.mp3", scene));
            sounds.push(new BABYLON.Sound("si1", "http://localhost:5500/assets/PianoNotes/12-si1.mp3", scene));
            sounds.push(new BABYLON.Sound("do2", "http://localhost:5500/assets/PianoNotes/13-do2.mp3", scene));
            sounds.push(new BABYLON.Sound("do2sus", "http://localhost:5500/assets/PianoNotes/14-do2sus.mp3", scene));
            sounds.push(new BABYLON.Sound("re2", "http://localhost:5500/assets/PianoNotes/15-re2.mp3", scene));
            sounds.push(new BABYLON.Sound("re2sus", "http://localhost:5500/assets/PianoNotes/16-re2sus.mp3", scene));
            sounds.push(new BABYLON.Sound("mi2", "http://localhost:5500/assets/PianoNotes/17-mi2.mp3", scene));
            sounds.push(new BABYLON.Sound("fa2", "http://localhost:5500/assets/PianoNotes/18-fa2.mp3", scene));
            sounds.push(new BABYLON.Sound("fa2sus", "http://localhost:5500/assets/PianoNotes/19-fa2sus.mp3", scene));
            sounds.push(new BABYLON.Sound("sol2", "http://localhost:5500/assets/PianoNotes/20-sol2.mp3", scene));
            sounds.push(new BABYLON.Sound("sol2sus", "http://localhost:5500/assets/PianoNotes/21-sol2sus.mp3", scene));
            sounds.push(new BABYLON.Sound("la2", "http://localhost:5500/assets/PianoNotes/22-la2.mp3", scene));
            sounds.push(new BABYLON.Sound("la2sus", "http://localhost:5500/assets/PianoNotes/23-la2sus.mp3", scene));
            sounds.push(new BABYLON.Sound("si2", "http://localhost:5500/assets/PianoNotes/24-si2.mp3", scene));
            sounds.push(new BABYLON.Sound("do3", "http://localhost:5500/assets/PianoNotes/25-do3.mp3", scene));

            return sounds;
        }

        function createBoardKeyboard(){
            var mat = new BABYLON.StandardMaterial("mat", scene);
            var texture = new BABYLON.Texture("assets/keyboard.webp", scene);

            mat.diffuseTexture = texture;

            var faceUV = new Array(6);

            faceUV[0] = new BABYLON.Vector4(686/931, 273/567, 732/931, 286/567);
            faceUV[1] = faceUV[0]
            faceUV[2] = faceUV[0]
            faceUV[3] = faceUV[0]
            faceUV[4] = new BABYLON.Vector4(856/931, 529/567, 73/931, 320/567);
            faceUV[5] = faceUV[0]

            const options = {
                width: 15,
                height: 2.5,
                depth: 53.1,
                faceUV: faceUV
            }
            var board = BABYLON.MeshBuilder.CreateBox("board", options, scene);

            board.setPositionWithLocalVector(new BABYLON.Vector3(0 , -0.25, 22.5));
            board.rotation.y = -(Math.PI)/2;
            board.material = mat;


            //criar frame ao redor das teclas
            var shape0 = [
                        new BABYLON.Vector3(0, 0, 0),
                        new BABYLON.Vector3(2, 0, 0),
                        new BABYLON.Vector3(2, 0, 12),
                        new BABYLON.Vector3(51.25, 0, 12),
                        new BABYLON.Vector3(51.25, 0, 0),
                        new BABYLON.Vector3(53.25, 0, 0),
                        new BABYLON.Vector3(53.25, 0, 15),
                        new BABYLON.Vector3(0, 0, 15)
            ]

            var faceUV2 = new Array(10);

            faceUV2[0] = new BABYLON.Vector4(686/931, 273/567, 732/931, 286/567);
            faceUV2[1] = faceUV2[0];
            faceUV2[2] = faceUV2[0];
            faceUV2[3] = faceUV2[0];
            faceUV2[4] = faceUV2[0];
            faceUV2[5] = faceUV2[0];
            faceUV2[6] = faceUV2[0];
            faceUV2[7] = faceUV2[0];
            faceUV2[8] = faceUV2[0];
            faceUV2[9] = faceUV2[0];

            frameBoard = BABYLON.MeshBuilder.ExtrudePolygon("frameBoard", {shape:shape0, depth: 3.5, sideOrientation: BABYLON.Mesh.DOUBLESIDE, faceUV: faceUV2 });
            frameBoard.setPositionWithLocalVector(new BABYLON.Vector3(-26.5 , 2, 0));
            frameBoard.material = mat;

            //texto Mini25
            var faceUV3 = new Array(6);

            faceUV3[0] = new BABYLON.Vector4(686/931, 273/567, 732/931, 286/567);
            faceUV3[1] = faceUV3[0];
            faceUV3[2] = faceUV3[0];
            faceUV3[3] = faceUV3[0];
            faceUV3[4] = new BABYLON.Vector4(755/931, 269/567, 836/931, 290/567);
            faceUV3[5] = faceUV3[0];

            const options2 = {
                width: 2,
                height: 0.5,
                depth: 8,
                faceUV: faceUV3
            }
            var textMini25 = BABYLON.MeshBuilder.CreateBox("mini25", options2, scene);

            textMini25.setPositionWithLocalVector(new BABYLON.Vector3(18 , 1.8, 13.5));
            textMini25.rotation.y = (Math.PI)/2;
            textMini25.material = mat;
            
            //botões Demo
            for(i = 0; i < 8; i++){
                var faceUVbtDemo = new Array(6);

                if(i < 4){
                    var a = 476 + 98 * i;
                    var b = 443;
                    var c = 541 + 98 * i;
                    var d = 509;

                    var positionBtDemo = new BABYLON.Vector3(i * 6.45 + 3.2, 1, 26.1);
                }
                else{
                    var a = 476 + 98 * (i - 4);
                    var b = 443 - 93;
                    var c = 541 + 98 * (i - 4);
                    var d = 509 - 93;

                    var positionBtDemo = new BABYLON.Vector3((i - 4) * 6.45 + 3.2, 1, 19.2);
                }

                faceUVbtDemo[4] = new BABYLON.Vector4(a/931, b/567, c/931, d/567);
                faceUVbtDemo[0] = new BABYLON.Vector4(a/931, b/567, (a+10)/931, (b+10)/567);
                faceUVbtDemo[1] = faceUVbtDemo[0];
                faceUVbtDemo[2] = faceUVbtDemo[0];
                faceUVbtDemo[3] = faceUVbtDemo[0];         
                faceUVbtDemo[5] = faceUVbtDemo[0];

                const optionsBtDemo = {
                    width: 5.2,
                    height: 0.5,
                    depth: 5.2,
                    faceUV: faceUVbtDemo
                }
                
                var idBtDemo = i + 1;
                var btDemo = BABYLON.MeshBuilder.CreateBox("btDemo" + idBtDemo, optionsBtDemo, scene);
                btDemo.setPositionWithLocalVector(positionBtDemo);
                btDemo.rotation.y = (Math.PI)/2;
                btDemo.material = mat;
            }

        }
        
        function createParticles(tile){
            const particleSystem = new BABYLON.ParticleSystem("particles", 2000);
            //Texture of each particle
            particleSystem.particleTexture = new BABYLON.Texture("assets/Flare.png");

            // Position where the particles are emiited from
            if(tile.name.includes("white")){
                particleSystem.emitter = new BABYLON.Vector3(tile.position.x + 1.5, tile.position.y + 1, tile.position.z + 2);
            }
            else{
                particleSystem.emitter = new BABYLON.Vector3(tile.position.x + 1.5, tile.position.y + 2, tile.position.z + 2);
            }
            
            particleSystem.start();
            
            particleSystem.targetStopDuration = 0.3;
        }

        var engine;
        var scene;
        initFunction = async function() {
        var asyncEngineCreation = async function() {
            try {
                return createDefaultEngine();
            } catch(e) {
                console.log("the available createEngine function failed. Creating the default engine instead");
                return createDefaultEngine();
                }
            }

            engine = await asyncEngineCreation();

            if (!engine)
                throw 'engine should not be null.';

            scene = createScene();
        };

        initFunction().then(() => {sceneToRender = scene
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
